{% load static %}

<!-- ðŸŸ  Sticky Navigation Bar with Animated Dropdowns -->
<nav class="sticky top-0 z-50 bg-orange-500 h-[60px] w-full text-white shadow-md">

  <div class="max-w-[1440px] mx-auto px-[60px] h-full flex items-center justify-between">
    <!-- Logo -->
    <a href="{% url 'home' %}">
      <img src="{% static 'images/logo.png' %}" alt="Kinbo Logo" class="h-8 w-auto">
    </a>

    <!-- Desktop Right -->
    <div class="hidden lg:flex items-center space-x-6">
      <a href="{% url 'cart' %}" class="hover:underline">
        <img src="{% static 'images/cart.png' %}" alt="Cart" class="h-5 w-5">
      </a>

      {% if user.is_authenticated %}
      <!-- Profile Dropdown -->
      <div class="relative">
        <button id="profile-btn" class="flex items-center focus:outline-none">
          <img src="{% static 'images/user.png' %}" alt="Profile" class="h-8 w-8 rounded-full">
        </button>
        <div id="profile-dropdown"
             class="absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded shadow-lg py-2 opacity-0 scale-95 transform origin-top-right transition-all duration-300 pointer-events-none z-50">
          <a href="{% url 'edit_profile' %}" class="block px-4 py-2 hover:bg-orange-100">Edit Profile</a>
          <a href="{% url 'orders' %}" class="block px-4 py-2 hover:bg-orange-100">View Orders</a>
          <a href="{% url 'logout' %}" class="block px-4 py-2 hover:bg-orange-100">Logout</a>
        </div>
      </div>
      {% else %}
      <a href="{% url 'login' %}" class="text-sm hover:underline flex items-center space-x-1">
        <img src="{% static 'images/signin.png' %}" alt="Sign In" class="h-5 w-5">
        <span>Sign In</span>
      </a>
      {% endif %}
    </div>

    <!-- Mobile Hamburger -->
    <div class="lg:hidden flex items-center">
      <button id="menu-toggle" class="focus:outline-none relative z-50">
        <svg id="hamburger-icon" class="w-6 h-6 transition-all duration-200" fill="none" stroke="currentColor"
             stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg id="close-icon" class="w-6 h-6 hidden transition-all duration-200" fill="none" stroke="currentColor"
             stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Desktop Search -->
  <form action="{% url 'search' %}" method="GET"
        class="hidden lg:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-xl px-4">
    <div class="relative w-full flex items-center">
      <img src="{% static 'images/search.png' %}" alt="Search"
           class="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2">
      <input type="text" name="q" placeholder="Search for any product or brand"
             class="w-full rounded-l-full py-2 pl-10 pr-4 text-sm text-gray-800 placeholder-gray-400 focus:outline-none">
    </div>
    <button type="submit"
            class="bg-orange-600 hover:bg-orange-700 text-white px-4 rounded-r-full text-sm flex items-center justify-center">
      <img src="{% static 'images/searchbutton.png' %}" alt="Search" class="h-5 w-5">
    </button>
  </form>

  <!-- Mobile Dropdown -->
  <div id="mobile-menu"
       class="lg:hidden origin-top transform scale-y-0 opacity-0 transition-all duration-300 ease-out bg-orange-500 px-[60px] py-4 space-y-6 border-t border-orange-600">

    <!-- Mobile Search -->
    <form action="{% url 'search' %}" method="GET" class="flex w-full">
      <div class="relative w-full flex items-center">
        <img src="{% static 'images/search.png' %}" alt="Search"
             class="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2">
        <input type="text" name="q" placeholder="Search"
               class="w-full rounded-l-full py-2 pl-10 pr-4 text-sm text-gray-800 placeholder-gray-400 focus:outline-none">
      </div>
      <button type="submit"
              class="bg-orange-600 hover:bg-orange-700 text-white px-4 rounded-r-full text-sm flex items-center justify-center">
        <img src="{% static 'images/searchbutton.png' %}" alt="Search" class="h-5 w-5">
      </button>
    </form>

    <!-- Mobile Buttons -->
    <div class="flex flex-col space-y-4">
      <a href="{% url 'cart' %}" class="text-orange-600 bg-white hover:bg-orange-100 font-semibold py-2 rounded text-center transition">
        Cart
      </a>
      {% if user.is_authenticated %}
      <a href="{% url 'edit_profile' %}" class="text-orange-600 bg-white hover:bg-orange-100 font-semibold py-2 rounded text-center transition">Edit Profile</a>
      <a href="{% url 'orders' %}" class="text-orange-600 bg-white hover:bg-orange-100 font-semibold py-2 rounded text-center transition">View Orders</a>
      <a href="{% url 'logout' %}" class="text-orange-600 bg-white hover:bg-orange-100 font-semibold py-2 rounded text-center transition">Logout</a>
      {% else %}
      <a href="{% url 'login' %}" class="text-orange-600 bg-white hover:bg-orange-100 font-semibold py-2 rounded text-center transition">Sign In</a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- ðŸ”§ Toggle & Animation Script -->
<script>
  const toggleBtn = document.getElementById('menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  const closeIcon = document.getElementById('close-icon');
  const profileBtn = document.getElementById('profile-btn');
  const profileDropdown = document.getElementById('profile-dropdown');

  // Mobile Hamburger Animation
  toggleBtn.addEventListener('click', () => {
    menu.classList.toggle('scale-y-100');
    menu.classList.toggle('scale-y-0');
    menu.classList.toggle('opacity-100');
    menu.classList.toggle('opacity-0');
    hamburgerIcon.classList.toggle('hidden');
    closeIcon.classList.toggle('hidden');
  });

  // Profile Dropdown Animation
  if (profileBtn) {
    profileBtn.addEventListener('click', () => {
      profileDropdown.classList.toggle('opacity-100');
      profileDropdown.classList.toggle('scale-100');
      profileDropdown.classList.toggle('opacity-0');
      profileDropdown.classList.toggle('scale-95');
      profileDropdown.classList.toggle('pointer-events-none');
    });
  }

  // Close on outside click
  document.addEventListener('click', (event) => {
    if (!menu.contains(event.target) && !toggleBtn.contains(event.target)) {
      menu.classList.add('scale-y-0', 'opacity-0');
      menu.classList.remove('scale-y-100', 'opacity-100');
      hamburgerIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
    }
    if (profileDropdown && !profileDropdown.contains(event.target) && !profileBtn.contains(event.target)) {
      profileDropdown.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
      profileDropdown.classList.remove('opacity-100', 'scale-100');
    }
  });
</script>
